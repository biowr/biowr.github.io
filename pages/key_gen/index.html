<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MobaXterm Keygen</title>

    <script src="./source/js/vue/vue.min-2.6.12.js"></script>
    <script src="./source/js/FileSaver/FileSaver.min.js"></script>
    <script src="./source/js/jszip/jszip.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500;600&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background-color: #0a0a0a;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: 'Fira Code', 'Consolas', 'Monaco', monospace;
            padding: 20px;
            position: relative;
            overflow: hidden;
        }

        /* 扫描线效果 */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: repeating-linear-gradient(
                0deg,
                rgba(0, 0, 0, 0.15),
                rgba(0, 0, 0, 0.15) 1px,
                transparent 1px,
                transparent 2px
            );
            pointer-events: none;
            z-index: 1000;
        }

        /* 背景网格 */
        body::after {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image:
                radial-gradient(circle at 25% 25%, rgba(0, 255, 136, 0.03) 0%, transparent 50%),
                radial-gradient(circle at 75% 75%, rgba(0, 255, 136, 0.03) 0%, transparent 50%);
            pointer-events: none;
            z-index: -1;
        }

        .terminal-window {
            background: linear-gradient(180deg, #1a1a2e 0%, #16213e 100%);
            border: 1px solid #00ff88;
            border-radius: 8px;
            width: 100%;
            max-width: 650px;
            box-shadow:
                0 0 20px rgba(0, 255, 136, 0.3),
                0 0 60px rgba(0, 255, 136, 0.1),
                inset 0 0 60px rgba(0, 0, 0, 0.5);
            overflow: hidden;
        }

        /* 终端标题栏 */
        .terminal-header {
            background: linear-gradient(90deg, #1a1a2e 0%, #0f3460 50%, #1a1a2e 100%);
            padding: 12px 16px;
            display: flex;
            align-items: center;
            border-bottom: 1px solid #00ff88;
        }

        .terminal-buttons {
            display: flex;
            gap: 8px;
        }

        .terminal-btn {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            border: none;
        }

        .terminal-btn.close { background: #ff5f56; }
        .terminal-btn.minimize { background: #ffbd2e; }
        .terminal-btn.maximize { background: #27ca40; }

        .terminal-title {
            flex: 1;
            text-align: center;
            color: #00ff88;
            font-size: 14px;
            text-shadow: 0 0 10px rgba(0, 255, 136, 0.5);
            letter-spacing: 2px;
        }

        /* 语言切换按钮 */
        .lang-switch {
            display: flex;
            gap: 4px;
        }

        .lang-btn {
            background: transparent;
            border: 1px solid rgba(0, 255, 136, 0.4);
            color: rgba(0, 255, 136, 0.5);
            padding: 4px 8px;
            font-family: inherit;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.3s ease;
            border-radius: 3px;
        }

        .lang-btn:hover {
            border-color: #00ff88;
            color: #00ff88;
        }

        .lang-btn.active {
            background: rgba(0, 255, 136, 0.2);
            border-color: #00ff88;
            color: #00ff88;
        }

        /* 终端内容区 */
        .terminal-body {
            padding: 30px;
        }

        .ascii-art {
            color: #00ff88;
            font-size: 10px;
            line-height: 1.2;
            text-align: center;
            margin-bottom: 20px;
            text-shadow: 0 0 5px rgba(0, 255, 136, 0.5);
            white-space: pre;
        }

        .terminal-prompt {
            color: #00ff88;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px dashed rgba(0, 255, 136, 0.3);
        }

        .prompt-line {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .prompt-symbol {
            color: #ff6b6b;
            font-weight: bold;
        }

        .prompt-path {
            color: #4ecdc4;
        }

        .prompt-text {
            color: #00ff88;
        }

        /* 闪烁光标 */
        .cursor {
            display: inline-block;
            width: 10px;
            height: 18px;
            background: #00ff88;
            animation: blink 1s infinite;
            vertical-align: middle;
            margin-left: 5px;
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }

        /* 表单样式 */
        .form-group {
            margin-bottom: 20px;
        }

        .form-row {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: nowrap;
        }

        .form-label {
            color: #4ecdc4;
            width: 150px;
            flex-shrink: 0;
            white-space: nowrap;
        }

        .form-label::before {
            content: '> ';
            color: #ff6b6b;
        }

        .form-input, .form-select {
            flex: 1;
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid #00ff88;
            color: #00ff88;
            padding: 10px 15px;
            font-family: inherit;
            font-size: 14px;
            border-radius: 4px;
            outline: none;
            transition: all 0.3s ease;
        }

        .form-input:focus, .form-select:focus {
            box-shadow: 0 0 15px rgba(0, 255, 136, 0.4);
            border-color: #4ecdc4;
        }

        .form-input::placeholder {
            color: rgba(0, 255, 136, 0.4);
        }

        .form-select {
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='%2300ff88' viewBox='0 0 16 16'%3E%3Cpath d='M8 11L3 6h10l-5 5z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
            padding-right: 35px;
        }

        .form-select option {
            background: #1a1a2e;
            color: #00ff88;
        }

        /* 按钮样式 */
        .btn-container {
            display: flex;
            justify-content: center;
            margin-top: 30px;
        }

        .btn-generate {
            background: transparent;
            border: 2px solid #00ff88;
            color: #00ff88;
            padding: 12px 40px;
            font-family: inherit;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 3px;
        }

        .btn-generate::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0, 255, 136, 0.3), transparent);
            transition: left 0.5s ease;
        }

        .btn-generate:hover {
            background: rgba(0, 255, 136, 0.1);
            box-shadow: 0 0 30px rgba(0, 255, 136, 0.5);
            text-shadow: 0 0 10px rgba(0, 255, 136, 0.8);
        }

        .btn-generate:hover::before {
            left: 100%;
        }

        .btn-generate:active {
            transform: scale(0.98);
        }

        /* 验证提示 */
        .my-input {
            position: relative;
            flex: 1;
        }

        .my-input input {
            width: 100%;
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid #00ff88;
            color: #00ff88;
            padding: 10px 15px;
            font-family: inherit;
            font-size: 14px;
            border-radius: 4px;
            outline: none;
            transition: all 0.3s ease;
        }

        .my-input input:focus {
            box-shadow: 0 0 15px rgba(0, 255, 136, 0.4);
            border-color: #4ecdc4;
        }

        .my-input input::placeholder {
            color: rgba(0, 255, 136, 0.4);
        }

        .my-input-tips-wrap {
            position: absolute;
            bottom: calc(100% + 10px);
            left: 0;
            background: rgba(255, 107, 107, 0.9);
            border: 1px solid #ff6b6b;
            border-radius: 4px;
            padding: 8px 15px;
            z-index: 100;
            animation: fadeIn 0.3s ease;
        }

        .my-input-tips {
            color: #fff;
            font-size: 12px;
            white-space: nowrap;
        }

        .my-input-arrow {
            position: absolute;
            bottom: -6px;
            left: 15px;
            width: 0;
            height: 0;
            border-left: 6px solid transparent;
            border-right: 6px solid transparent;
            border-top: 6px solid #ff6b6b;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .hide {
            display: none;
        }

        /* 使用说明 */
        .usage-tip {
            margin-top: 25px;
            padding: 12px 15px;
            background: rgba(0, 255, 136, 0.05);
            border: 1px dashed rgba(0, 255, 136, 0.3);
            border-radius: 4px;
            display: flex;
            align-items: flex-start;
            gap: 10px;
        }

        .tip-icon {
            color: #4ecdc4;
            font-weight: bold;
            flex-shrink: 0;
            margin-top: 2px;
        }

        .tip-text {
            color: rgba(0, 255, 136, 0.8);
            font-size: 13px;
            margin: 0;
            line-height: 1.5;
        }

        /* 状态栏 */
        .status-bar {
            background: rgba(0, 0, 0, 0.3);
            padding: 8px 16px;
            display: flex;
            justify-content: space-between;
            font-size: 11px;
            color: rgba(0, 255, 136, 0.6);
            border-top: 1px solid rgba(0, 255, 136, 0.2);
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .status-dot {
            width: 6px;
            height: 6px;
            background: #27ca40;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
    </style>
</head>

<body>
    <div class="terminal-window">
        <div class="terminal-header">
            <div class="terminal-buttons">
                <div class="terminal-btn close"></div>
                <div class="terminal-btn minimize"></div>
                <div class="terminal-btn maximize"></div>
            </div>
            <div class="terminal-title">MOBAXTERM_KEYGEN.EXE</div>
            <div class="lang-switch" id="lang-switch">
                <button class="lang-btn" :class="{ active: lang === 'en' }" @click="setLang('en')">EN</button>
                <button class="lang-btn" :class="{ active: lang === 'zh' }" @click="setLang('zh')">中</button>
            </div>
        </div>

        <div id="app">
            <div class="terminal-body">
                <div class="ascii-art">
███╗   ███╗ ██████╗ ██████╗  █████╗ ██╗  ██╗
████╗ ████║██╔═══██╗██╔══██╗██╔══██╗╚██╗██╔╝
██╔████╔██║██║   ██║██████╔╝███████║ ╚███╔╝
██║╚██╔╝██║██║   ██║██╔══██╗██╔══██║ ██╔██╗
██║ ╚═╝ ██║╚██████╔╝██████╔╝██║  ██║██╔╝ ██╗
╚═╝     ╚═╝ ╚═════╝ ╚═════╝ ╚═╝  ╚═╝╚═╝  ╚═╝
        [ LICENSE GENERATOR v2.0 ]</div>

                <div class="terminal-prompt">
                    <div class="prompt-line">
                        <span class="prompt-symbol">root@keygen</span>
                        <span class="prompt-path">~/license</span>
                        <span class="prompt-text">$ ./generate --interactive</span>
                        <span class="cursor"></span>
                    </div>
                </div>

                <div class="form-group">
                    <div class="form-row">
                        <label class="form-label">{{ t.licenseType }}</label>
                        <select class="form-select" v-model="licenseType">
                            <option value="">{{ t.selectPlaceholder }}</option>
                            <option v-for="(val, key) in LICENSE_TYPES" :value="val">{{key}}</option>
                        </select>
                    </div>

                    <div class="form-row">
                        <label class="form-label">{{ t.userName }}</label>
                        <my-input :idattr="'userName'" :validation="'^[a-zA-Z]+$'" :valueattr="userName" :validationtips="t.userNameTip" :placeholderattr="t.userNamePlaceholder" @set-data="setUserName">
                        </my-input>
                    </div>

                    <div class="form-row">
                        <label class="form-label">{{ t.version }}</label>
                        <my-input :idattr="'versionName'" :validation="'^[1-9][0-9]*\\.?\\d{0,1}$'" :validationtips="t.versionTip" :valueattr="versionName" :placeholderattr="t.versionPlaceholder" @set-data="setVersionName"></my-input>
                    </div>

                    <div class="form-row">
                        <label class="form-label">{{ t.userCount }}</label>
                        <my-input :idattr="'userNum'" :validation="'^[1-9]+\\d*$'" :valueattr="userNum" :placeholderattr="t.userCountPlaceholder" :validationtips="t.userCountTip" @set-data="setUserNum">
                        </my-input>
                    </div>
                </div>

                <div class="btn-container">
                    <button class="btn-generate" @click.stop="generate">
                        [ {{ t.generateBtn }} ]
                    </button>
                </div>

                <div class="usage-tip">
                    <span class="tip-icon">[i]</span>
                    <p class="tip-text">{{ t.usageTip }}</p>
                </div>
            </div>

        </div>

        <div class="status-bar">
            <div class="status-item">
                <span class="status-dot"></span>
                <span>READY</span>
            </div>
            <div class="status-item">
                <span>UTF-8</span>
            </div>
            <div class="status-item">
                <span>LN 1, COL 1</span>
            </div>
        </div>
    </div>

    <script type="module">
        import { LicenseType, generateLicense } from './js/mobaXtermGenerater.js';

        const i18n = {
            en: {
                licenseType: 'LICENSE_TYPE',
                userName: 'USER_NAME',
                version: 'VERSION',
                userCount: 'USER_COUNT',
                selectPlaceholder: '-- SELECT --',
                userNamePlaceholder: 'e.g. defaultUser',
                userNameTip: 'Only letters allowed',
                versionPlaceholder: 'e.g. 25.4',
                versionTip: 'Format: X.X',
                userCountPlaceholder: 'e.g. 10',
                userCountTip: 'Number >= 1',
                generateBtn: 'GENERATE',
                usageTip: 'Place the downloaded Custom.mxtpro in the same folder as MobaXterm.exe, then restart the application.',
                alertUserName: 'Please enter username',
                alertVersion: 'Please enter version'
            },
            zh: {
                licenseType: '许可类型',
                userName: '用户名',
                version: '版本号',
                userCount: '用户数量',
                selectPlaceholder: '-- 请选择 --',
                userNamePlaceholder: '例如 defaultUser',
                userNameTip: '只能输入字母',
                versionPlaceholder: '例如 25.4',
                versionTip: '格式: X.X',
                userCountPlaceholder: '例如 10',
                userCountTip: '数字且 >= 1',
                generateBtn: '生成',
                usageTip: '将下载的 Custom.mxtpro 放入 MobaXterm.exe 所在目录，重启程序即可激活。',
                alertUserName: '请输入用户名',
                alertVersion: '请输入版本号'
            }
        };

        var app = new Vue({
            el: '#app',
            data() {
                return {
                    lang: 'en',
                    userName: 'defaultUser',
                    versionName: '25.4',
                    userNum: 10,
                    licenseType: 1,
                    LICENSE_TYPES: LicenseType
                }
            },
            computed: {
                t() {
                    return i18n[this.lang];
                }
            },
            methods: {
                setLang(lang) {
                    this.lang = lang;
                },
                setUserName(newVal) {
                    this.userName = newVal;
                },
                setVersionName(newVal) {
                    this.versionName = newVal;
                },
                setUserNum(newVal) {
                    this.userNum = newVal;
                },
                generate() {
                    if (!this.userName) {
                        alert(this.t.alertUserName);
                        return;
                    }
                    if (!this.versionName) {
                        alert(this.t.alertVersion);
                        return;
                    }
                    if (!this.userNum) this.userNum = 1;

                    let versionNameArr = this.versionName.split('.');
                    const majorVersion = parseInt(versionNameArr[0]);
                    const minorVersion = versionNameArr.length === 2 ? (parseInt(versionNameArr[1]) || 0) : 0;

                    let licenseStr = generateLicense(this.licenseType, this.userName, this.userNum, majorVersion, minorVersion);
                    this.generateLicenseFile(licenseStr);
                },
                generateLicenseFile(licenseStr) {
                    let zip = new JSZip();
                    zip.file("Pro.key", licenseStr);
                    zip.generateAsync({ type: "blob" })
                        .then(function (content) {
                            saveAs(content, "Custom.mxtpro");
                        });
                }
            },
            components: {
                'my-input': {
                    template: `
                        <div class="my-input">
                            <input :id="idattr" :placeholder="placeholderattr" v-model="value" required/>
                            <div :class="validationTipsDiplay" class="my-input-tips-wrap">
                                <span class="my-input-tips">{{validationtips}}</span>
                                <div class="my-input-arrow"></div>
                            </div>
                        </div>`,
                    data() {
                        return {
                            value: this.valueattr,
                            validationTipsDiplay: 'hide',
                            tipsDisplayTimeout: undefined
                        }
                    },
                    props: {
                        idattr: { type: String, default: '' },
                        placeholderattr: { type: String, default: '' },
                        valueattr: '',
                        validation: { type: String, default: '' },
                        validationtips: ''
                    },
                    watch: {
                        valueattr(newVal, oldVal) {
                            this.value = newVal;
                        },
                        value(newVal, oldVal) {
                            if (newVal && this.validation) {
                                let reg = new RegExp(this.validation);
                                if (!reg.test(newVal)) {
                                    this.validationTipsDiplay = '';
                                    this.value = oldVal;
                                    if (this.tipsDisplayTimeout) clearTimeout(this.tipsDisplayTimeout);
                                    var _this = this;
                                    this.tipsDisplayTimeout = setTimeout(function () {
                                        _this.tipsDisplayTimeout = undefined;
                                        _this.validationTipsDiplay = 'hide';
                                    }, 1000);
                                    return;
                                }
                            }
                            this.$emit('set-data', newVal);
                        }
                    }
                }
            }
        });

        // 语言切换按钮单独的 Vue 实例（因为在 #app 外部）
        new Vue({
            el: '#lang-switch',
            data: {
                lang: 'en'
            },
            methods: {
                setLang(lang) {
                    this.lang = lang;
                    app.setLang(lang);
                }
            }
        });
    </script>
</body>

</html>
